<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ryan's JS13k Game</title><style>
body{background:#000}#gamecontainer{margin:0 auto}#game{margin:auto;position:absolute;top:0;left:0;bottom:0;right:0;width:800px;height:600px;border:1px solid #555}canvas,img{border:1px solid #555;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:optimize-contrast;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;border:5px solid #ddd}
</style></head><body><div id="gamecontainer"><canvas id="game" width="810" height="600"></canvas></div><script>
var GAME=function(){var a=function(){function b(a){return e.appendChild(a.dom),a}function c(a){for(var b=0;b<e.children.length;b++)e.children[b].style.display=b===a?"block":"none";d=a}var d=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(a){a.preventDefault(),c(++d%e.children.length)},!1);var f=(performance||Date).now(),g=f,h=0,i=b(new a.Panel("FPS","#0ff","#002")),j=b(new a.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var k=b(new a.Panel("MB","#f08","#201"));return c(0),{REVISION:16,dom:e,addPanel:b,showPanel:c,begin:function(){f=(performance||Date).now()},end:function(){h++;var a=(performance||Date).now();if(j.update(a-f,200),a>g+1e3&&(i.update(1e3*h/(a-g),100),g=a,h=0,k)){var b=performance.memory;k.update(b.usedJSHeapSize/1048576,b.jsHeapSizeLimit/1048576)}return a},update:function(){f=this.end()},domElement:e,setMode:c}};a.Panel=function(a,b,c){var d=1/0,e=0,f=Math.round,g=f(window.devicePixelRatio||1),h=80*g,i=48*g,j=3*g,k=2*g,l=3*g,m=15*g,n=74*g,o=30*g,p=document.createElement("canvas");p.width=h,p.height=i,p.style.cssText="width:80px;height:48px";var q=p.getContext("2d");return q.font="bold "+9*g+"px Helvetica,Arial,sans-serif",q.textBaseline="top",q.fillStyle=c,q.fillRect(0,0,h,i),q.fillStyle=b,q.fillText(a,j,k),q.fillRect(l,m,n,o),q.fillStyle=c,q.globalAlpha=.9,q.fillRect(l,m,n,o),{dom:p,update:function(i,r){d=Math.min(d,i),e=Math.max(e,i),q.fillStyle=c,q.globalAlpha=1,q.fillRect(0,0,h,m),q.fillStyle=b,q.fillText(f(i)+" "+a+" ("+f(d)+"-"+f(e)+")",j,k),q.drawImage(p,l+g,m,n-g,o,l,m,n-g,o),q.fillRect(l+n-g,m,g,o),q.fillStyle=c,q.globalAlpha=.9,q.fillRect(l+n-g,m,g,f((1-i/r)*o))}}},"object"==typeof module&&(module.exports=a);var b=0,c=new a;c.showPanel(0),document.body.appendChild(c.dom);var d=[],f=60,g=1/f,h=0,i=L(),j=L(),k={},l={},m={},n=new U(2e3,S),o=new U(25,Q),p=new U(100,S),q={GAMEWIDTH:270,GAMEHEIGHT:200,SCALE:3,GRID:10,WIDTH:27,HEIGHT:20,P_SPEED:1,P_JUMP:1,E_SPEED:.5,E_JUMP:.25,GLITCH:{xch:0,xamt:10,ych:0,yamt:10}},r=2,s=0,t=15,u=document.querySelector("#game"),v=u.getContext("2d");v.imageSmoothingEnabled=!1,v.mozImageSmoothingEnabled=!1;var w=document.createElement("canvas");w.width=q.GAMEWIDTH,w.height=q.GAMEHEIGHT;var x=w.getContext("2d"),y=document.createElement("canvas");y.width=q.GAMEWIDTH,y.height=q.GAMEHEIGHT;var z=y.getContext("2d"),A=document.createElement("canvas");A.width=q.GAMEWIDTH,A.height=q.GAMEHEIGHT;var B=A.getContext("2d"),C=document.createElement("canvas");C.width=q.GAMEWIDTH,C.height=q.GAMEHEIGHT;var D=C.getContext("2d"),E=F();function F(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=q.GAMEWIDTH*q.SCALE,a.height=q.GAMEHEIGHT*q.SCALE,b.fillStyle="#808080",b.fillRect(0,0,a.width,a.height);for(var c=0;c<=q.GAMEWIDTH;c++)for(var d=0;d<=q.GAMEHEIGHT;d++)b.fillStyle="#e0e0e0",b.fillRect(c*q.SCALE,d*q.SCALE,2,2),b.fillStyle="#707070",b.fillRect(c*q.SCALE,d*q.SCALE+2,1,1),b.fillStyle="#f8f8f8",b.fillRect(c*q.SCALE+2,d*q.SCALE,1,1);return{canvas:a,context:b}}var G={render:function(a){for(var b=R.map,c=["","oO\nOo","yy\nyy","yy\nyy"],d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++)b[d][e]&&(a.fillStyle="#779",Txt.text({ctx:a,x:e*q.GRID,y:d*q.GRID,text:c[b[d][e]],hspacing:0,vspacing:0,halign:"top",valign:"left",scale:1,snap:1,render:1,glitch:q.GLITCH}))}};function H(a,b){return Math.random()*(b-a+1)+a}function I(a,b){for(var c="",d=b;d--;)c+=a.charAt(Math.floor(Math.random()*a.length));return c}function J(a,b,c){return(a-b)/(c-b)}function K(){n.init(),p.init(),o.init(),l=P.create({initial:"init",events:[{name:"load",from:"init",to:"boot"},{name:"ready",from:"boot",to:"menu"},{name:"play",from:["menu","gameover"],to:"game"},{name:"lose",from:"game",to:"gameover"},{name:"reset",from:["init","boot","menu","gameover","game"],to:"boot"}],callbacks:{onenterboot:function(a,b,c){m.boot.onenter(a,b,c)},onentermenu:function(a,b,c){m.menu.onenter(a,b,c)},onleavemenu:function(a,b,c){m.menu.onexit(a,b,c)},onentergame:function(a,b,c){m.game.onenter(a,b,c)},onleavegame:function(a,b,c){m.game.onexit(a,b,c)},onentergameover:function(a,b,c){m.gameover.onenter(a,b,c)}}}),window.addEventListener("keyup",function(a){Key.onKeyup(a)},!1),window.addEventListener("keydown",function(a){Key.onKeydown(a)},!1),l.load(),N()}function L(){return(new Date).getTime()}initAudio=function(){k.loaded=0,k.total=7,window.AudioContext=window.AudioContext||window.webkitAudioContext,Z=new AudioContext,soundGen=new V.SoundGenerator(R.sounds.jump),soundGen.createAudioBuffer(171,function(a){k.loaded++,k.jump=a}),soundGen=new V.SoundGenerator(R.sounds.shoot),soundGen.createAudioBuffer(147,function(a){k.loaded++,k.shoot=a}),soundGen=new V.SoundGenerator(R.sounds.boom),soundGen.createAudioBuffer(147,function(a){k.loaded++,k.boom=a}),soundGen=new V.SoundGenerator(R.sounds.engineSound4),soundGen.createAudioBuffer(171,function(a){k.loaded++,k.es4=a}),soundGen=new V.SoundGenerator(R.sounds.engineSound5),soundGen.createAudioBuffer(171,function(a){k.loaded++,k.es5=a}),soundGen=new V.MusicGenerator(R.song),soundGen.createAudioBuffer(function(a){k.song=a,k.loaded++}),soundGen=new V.MusicGenerator(R.titlesong),soundGen.createAudioBuffer(function(a){k.titlesong=a,k.loaded++})};function M(a,b,c,d){var e=Z.createBufferSource(),f=Z.createGain(),g=Z.createStereoPanner();return e.buffer=a,e.connect(g),g.connect(f),f.connect(Z.destination),e.playbackRate.value=b,e.loop=d,f.gain.value=1,g.pan.value=c,e.start(),{volume:f,sound:e}}function N(){for(c.begin(),i=L(),h+=Math.min(1,(i-j)/1e3),m[l.current].render(z);h>g;)h-=g,m[l.current].update(g);j=i,D.drawImage(w,0,0),D.drawImage(y,0,0),D.drawImage(A,0,0),v.save(),v.fillStyle="black",v.fillRect(0,0,q.GAMEWIDTH*q.SCALE,q.GAMEHEIGHT*q.SCALE),v.drawImage(C,0,0,q.GAMEWIDTH,q.GAMEHEIGHT,0,0,q.GAMEWIDTH*q.SCALE,q.GAMEHEIGHT*q.SCALE),v.restore(),v.save(),v.globalCompositeOperation="overlay",v.drawImage(E.canvas,0,0),v.restore(),c.end(),requestAnimationFrame(N)}function O(){D.clearRect(0,0,q.GAMEWIDTH,q.GAMEHEIGHT),x.clearRect(0,0,q.GAMEWIDTH,q.GAMEHEIGHT),z.clearRect(0,0,q.GAMEWIDTH,q.GAMEHEIGHT),B.clearRect(0,0,q.GAMEWIDTH,q.GAMEHEIGHT)}var P={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,b){var c="string"==typeof a.initial?{state:a.initial}:a.initial,d=a.terminal||a.final,e=b||a.target||{},f=a.events||[],g=a.callbacks||{},h={},i={},j=function(a){var b=a.from instanceof Array?a.from:a.from?[a.from]:[P.WILDCARD];h[a.name]=h[a.name]||{};for(var c=0;c<b.length;c++)i[b[c]]=i[b[c]]||[],i[b[c]].push(a.name),h[a.name][b[c]]=a.to||b[c]};c&&(c.event=c.event||"startup",j({name:c.event,from:"none",to:c.state}));for(var k=0;k<f.length;k++)j(f[k]);for(var l in h)h.hasOwnProperty(l)&&(e[l]=P.buildEvent(l,h[l]));for(var l in g)g.hasOwnProperty(l)&&(e[l]=g[l]);return e.current="none",e.is=function(a){return a instanceof Array?a.indexOf(this.current)>=0:this.current===a},e.can=function(a){return!this.transition&&(h[a].hasOwnProperty(this.current)||h[a].hasOwnProperty(P.WILDCARD))},e.cannot=function(a){return!this.can(a)},e.transitions=function(){return i[this.current]},e.isFinished=function(){return this.is(d)},e.error=a.error||function(a,b,c,d,e,f,g){throw g||f},c&&!c.defer&&e[c.event](),e},doCallback:function(a,b,c,d,e,f){if(b)try{return b.apply(a,[c,d,e].concat(f))}catch(g){return a.error(c,d,e,f,P.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",g)}},beforeAnyEvent:function(a,b,c,d,e){return P.doCallback(a,a.onbeforeevent,b,c,d,e)},afterAnyEvent:function(a,b,c,d,e){return P.doCallback(a,a.onafterevent||a.onevent,b,c,d,e)},leaveAnyState:function(a,b,c,d,e){return P.doCallback(a,a.onleavestate,b,c,d,e)},enterAnyState:function(a,b,c,d,e){return P.doCallback(a,a.onenterstate||a.onstate,b,c,d,e)},changeState:function(a,b,c,d,e){return P.doCallback(a,a.onchangestate,b,c,d,e)},beforeThisEvent:function(a,b,c,d,e){return P.doCallback(a,a["onbefore"+b],b,c,d,e)},afterThisEvent:function(a,b,c,d,e){return P.doCallback(a,a["onafter"+b]||a["on"+b],b,c,d,e)},leaveThisState:function(a,b,c,d,e){return P.doCallback(a,a["onleave"+c],b,c,d,e)},enterThisState:function(a,b,c,d,e){return P.doCallback(a,a["onenter"+d]||a["on"+d],b,c,d,e)},beforeEvent:function(a,b,c,d,e){return!1===P.beforeThisEvent(a,b,c,d,e)||!1===P.beforeAnyEvent(a,b,c,d,e)?!1:void 0},afterEvent:function(a,b,c,d,e){P.afterThisEvent(a,b,c,d,e),P.afterAnyEvent(a,b,c,d,e)},leaveState:function(a,b,c,d,e){var f=P.leaveThisState(a,b,c,d,e),g=P.leaveAnyState(a,b,c,d,e);return!1===f||!1===g?!1:P.ASYNC===f||P.ASYNC===g?P.ASYNC:void 0},enterState:function(a,b,c,d,e){P.enterThisState(a,b,c,d,e),P.enterAnyState(a,b,c,d,e)},buildEvent:function(a,b){return function(){var c=this.current,d=b[c]||b[P.WILDCARD]||c,e=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,c,d,e,P.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,c,d,e,P.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===P.beforeEvent(this,a,c,d,e))return P.Result.CANCELLED;if(c===d)return P.afterEvent(this,a,c,d,e),P.Result.NOTRANSITION;var f=this;this.transition=function(){return f.transition=null,f.current=d,P.enterState(f,a,c,d,e),P.changeState(f,a,c,d,e),P.afterEvent(f,a,c,d,e),P.Result.SUCCEEDED},this.transition.cancel=function(){f.transition=null,P.afterEvent(f,a,c,d,e)};var g=P.leaveState(this,a,c,d,e);return!1===g?(this.transition=null,P.Result.CANCELLED):P.ASYNC===g?P.Result.PENDING:this.transition?this.transition():void 0}}};m.game={onenter:function(a,c){switch(c){case"menu":player=new Player({x:q.GAMEWIDTH/2,y:100}),glitchbox=new Glitchbox({x:70,y:100}),song=M(k.song,1,0,!1);break;case"gameover":b=0,player.body.setCoords(q.GAMEWIDTH/2,100),song=M(k.song,1,0,!1),o.init(),n.init(),p.init(),q.GLITCH={xch:0,xamt:10,ych:0,yamt:10}}},onexit:function(){song.sound.stop()},render:function(){O(GAME),x.fillStyle="#223",Txt.text({ctx:x,x:10,y:0,text:"o o o\n o o \no o o\n o o ",hspacing:0,vspacing:0,halign:"top",valign:"left",scale:10,snap:1,render:1,glitch:q.GLITCH}),x.fillStyle="#111",x.globalCompositeOperation="screen",Txt.text({ctx:x,x:10,y:0,text:"ooooooooooo\nooooooooooo\nooooooooooo\nooooooooooo\nooooooooooo\nooooooooooo\nooooooooooo\nooooooooooo",hspacing:0,vspacing:0,halign:"top",valign:"left",scale:5,snap:1,render:1,glitch:q.GLITCH}),x.globalCompositeOperation="source-over",Txt.text({ctx:B,x:q.GAMEWIDTH/2,y:10,text:""+b,color:"#c90",hspacing:2,vspacing:1,halign:"center",valign:"center",scale:2,snap:1,render:1,glitch:q.GLITCH}),G.render(z),player.render(z),glitchbox.render(z)},update:function(a){n.get({x:110+50*Math.random(),y:205,mapcollide:!0,gravity:-.004,radius:4,color:"#a20",life:.8}),s-=a,s>0||(o.get({x:q.GAMEWIDTH/2,y:0}),s=r),player.update(a),glitchbox.update(a),player.body.update(a),glitchbox.body.update(a),n.use(),o.use(),p.use();for(var b=o.getPool().slice(),c=p.getPool().slice(),d=0;d<b.length;d++)for(var e=0;e<c.length;e++)b[d].inUse&&c[e].inUse&&Entity.prototype.overlaps(b[d].body,c[e].body)&&(b[d].dead=!0,c[e].dead=!0);for(var e=0;e<b.length;e++)b[e].inUse&&Entity.prototype.overlaps(player.body,b[e].body)&&player.die();Entity.prototype.overlaps(player.body,glitchbox.body)&&(glitchbox.die(),player.currentGun=player.makeGun())}},m.menu={onenter:function(a){"ready"==a&&(titlesong=M(k.titlesong,1,0,!0))},onexit:function(a){"play"==a&&titlesong.sound.stop()},render:function(){O(GAME),B.fillStyle="#e80",Txt.text({ctx:B,x:q.GAMEWIDTH/2,y:20,text:"SUPER\n\nBOX",hspacing:2,vspacing:5,halign:"center",valign:"top",scale:5,snap:1,render:1}),B.fillStyle="#cc0",Txt.text({ctx:B,x:q.GAMEWIDTH/2,y:50,text:"GLITCH",hspacing:2,vspacing:2,halign:"center",valign:"top",scale:5,snap:1,render:1,glitch:{xch:.1,xamt:10,ych:0,yamt:0}}),B.save(),B.fillStyle="#fff",Txt.text({ctx:B,x:q.GAMEWIDTH/2,y:150,text:"A+D/ARROWS: MOVE\nSPACE/Z: SHOOT   X:JUMP\nPRESS Z TO PLAY",hspacing:2,vspacing:2,halign:"center",valign:"top",scale:1,snap:1,render:1}),B.restore()},update:function(){Key.isDown(Key.z)&&"menu"==l.current&&l.play();for(var a=2;a--;)n.get({x:Math.random()*q.GAMEWIDTH,y:220,mapcollide:!1,collides:!1,gravity:-.03,radius:H(2,20),color:"rgba(0,40,40, 1)",stroke:"green",life:5});n.use()}},m.boot={onenter:function(){k.jump||initAudio()},render:function(){O(GAME),d=[];for(var a=q.WIDTH;a--;)B.fillStyle="#020",Txt.text({ctx:B,x:a*(q.GRID+2),y:70,text:I("wesdxz",2)+"\n"+I("wesdxz",2)+"\n"+I("wesdxz",2),hspacing:1,vspacing:1,halign:"top",valign:"left",scale:1,snap:1,render:1});var b=["INITIALIZING...","RENDERING SOUNDS...","CONFIGURATING PIXELS....","RETICULATING SPLINES...","MESSAGE 42","STIRRING THE PARTICLE POOL...","BREEDING BADDIES...","READY. PRESS X TO CONTINUE"];v.clearRect(0,0,q.GAMEWIDTH,q.GAMEHEIGHT),B.fillStyle=7==k.loaded?"#0f0":"#080",Txt.text({ctx:B,x:18,y:79,text:b[k.loaded],hspacing:1,vspacing:1,halign:"top",valign:"center",scale:1,snap:1,render:1,glitchChance:0,glitchFactor:0})},update:function(){Key.isDown(Key.r)&&l.current&&l.reset(),k.loaded==k.total&&Key.isDown(Key.x)&&"boot"==l.current&&l.ready()}},m.gameover={onenter:function(){t=15},render:function(){B.clearRect(0,0,q.GAMEWIDTH,q.GAMEHEIGHT),B.fillStyle="rgba(0,0,0, .75)",Txt.text({ctx:B,x:q.GAMEWIDTH/2,y:0,text:"yyyyyy\nyyyyyy\nyyyyyy\nyyyyyy",hspacing:0,vspacing:0,halign:"center",valign:"left",scale:10,snap:1,render:1,glitch:{xch:0,ych:1,yamt:t,xamt:0}}),B.fillStyle="#f80",Txt.text({ctx:B,x:q.GAMEWIDTH/2,y:65,text:"GAME OVER",hspacing:2,vspacing:5,halign:"center",valign:"left",scale:4,snap:1,render:1,glitch:{xch:0,ych:1,yamt:t,xamt:0}}),B.fillStyle="#fff",Txt.text({ctx:B,x:q.GAMEWIDTH/2,y:100,text:"YOU COLLECTED "+b+" GLITCHES.\nS: SHARE YOUR SCORE VIA TWITTER\nX: PLAY AGAIN",hspacing:2,vspacing:5,halign:"center",valign:"left",scale:1,snap:1,render:1,glitch:{xch:0,ych:1,yamt:t,xamt:0}})},update:function(){t>0&&(t-=.5),Key.isDown(Key.x)&&"gameover"==l.current&&l.play(),Key.isDown(Key.s)&&window.open("https://twitter.com/intent/tweet?text=I%20just%20collected%20"+b+"%20glitches%20in%20Super%20Glitch%20Box%20%23js13k%20http%3A%2F%2Fbit.ly%2F2c7P6pm","_self")}},Player=function(a){this.body=new Entity({radius:8,type:"player",collides:!0,mapcollide:!0,gravity:.04}),this.body.setCoords(a.x,a.y),this.fl=!0,this.cooldown=0,this.justJumped=!1,this.justFired=!1,this.currentGun=null,Player.prototype.update=function(a){this.currentGun||(this.currentGun=this.makeGun()),player.currentGun.bullet.x=player.body.xx,player.currentGun.bullet.y=player.body.yy,player.currentGun.bullet.dx=this.fl?-player.currentGun.velocity:player.currentGun.velocity,this.cooldown-=a,Key.isDown(Key.LEFT)||Key.isDown(Key.a)?(this.fl=!0,player.body.dx-=q.P_SPEED*a):(Key.isDown(Key.RIGHT)||Key.isDown(Key.d))&&(this.fl=!1,player.body.dx+=q.P_SPEED*a),(Key.isDown(Key.UP)||Key.isDown(Key.w)||Key.isDown(Key.x))&&(this.body.onGround()&&(player.body.dy=-q.P_JUMP,player.justJumped=!0),player.justJumped&&(player.justJumped=!1,M(k.jump,H(.7,1.1),J(player.body.xx,0,q.GAMEWIDTH),!1))),player.body.yy>200&&player.die(),player.body.yy<5&&player.body.setCoords(this.body.xx,5),(Key.isDown(Key.SPACE)||Key.isDown(Key.z))&&(this.cooldown>0||(this.justFired=!0,p.get(this.currentGun.bullet),this.cooldown=this.currentGun.cooldown,this.justFired&&(this.justFired=!1,M(k.shoot,H(.95,1.1),J(player.body.xx,0,q.GAMEWIDTH)))))}},Player.prototype.render=function(a){a.save(),a.fillStyle="#ea0",player.fl&&a.scale(-1,1),Txt.text({ctx:a,x:player.fl?-1*(player.body.xx+player.body.radius):player.body.xx-player.body.radius,y:player.body.yy-player.body.radius-3,text:"tyu\nghj\nbnm",hspacing:Math.abs(15*player.body.dx),vspacing:Math.abs(15*player.body.dy),halign:"top",valign:"left",scale:1,snap:1,render:1,glitch:{xch:Math.abs(player.body.dx),xamt:5,ych:Math.abs(player.body.dy),yamt:5}}),a.restore()},Player.prototype.die=function(){T("player",this.body),player.body.setCoords(100,100),l.lose()},Player.prototype.makeGun=function(){var a=1.1*Math.random()+.5,b=.2*Math.random()+.02;return bullet={x:0,y:0,mapcollide:!0,collides:!1,gravity:0,frictX:0,frictY:0,dy:0,dx:0,radius:Math.floor(H(1,15)),color:"#f80",life:H(.5,3)},{bullet:bullet,cooldown:b,velocity:a}};function Q(){this.inUse=!1,this.init=function(){this.body=new Entity({dead:!0,gravity:0}),this.body.setCoords(-1e3,-1e3)},Q.prototype.spawn=function(a){this.inUse=!0,this.body.radius=Math.floor(H(3,9)),this.body.dead=!1,this.dead=!1,this.body.mapcollide=!0,this.onFire=!1,this.fireSpeed=0,this.bump=0,this.body.gravity=.06,this.movingLeft=Math.random()>.5,this.stridetick=0,this.antennae=Math.random()>.5,this.fill="#3"+I("4567789abcd",1)+"0",this.stroke="#3"+I("4567789abcd",1)+I("123",1),this.angryFill="#"+I("4567789abcd",1)+"00",this.angryStroke="#"+I("4567789abcd",1)+"00",this.body.setCoords(a.x,a.y)},Q.prototype.use=function(a){return this.dead?(T("enemy",this.body),T("smoke",this.body),M(k.boom,H(.98,1.05),J(this.body.xx,0,q.GAMEWIDTH),!1),!0):(this.render(z),this.update(a),this.body.update(a),!1)},Q.prototype.update=function(a){this.bump>0&&(this.bump-=.01),q.GLITCH.ych=this.bump,this.onFire?n.get({x:this.body.xx+this.body.radius-Math.random()*this.body.radius*2,y:this.body.yy-this.body.radius-2,mapcollide:!0,gravity:-.04,radius:4,color:"#a00",life:.4}):n.get({x:this.body.xx+this.body.radius-Math.random()*this.body.radius*2,y:this.body.yy-this.body.radius-2,mapcollide:!0,gravity:-.03,radius:2,color:"#080",life:.4}),this.stridetick+=.3,this.stride=2*Math.sin(this.stridetick),this.stride2=1.3*Math.sin(this.stridetick-.8),this.fireSpeed=this.onFire?2:1,this.movingLeft?this.body.dx-=q.E_SPEED*this.fireSpeed*a:this.body.dx+=q.E_SPEED*this.fireSpeed*a,this.body.onWallLeft()&&(this.movingLeft=!1),this.body.onWallRight()&&(this.movingLeft=!0),this.body.collided&&(this.movingLeft=!this.movingLeft,this.body.collided=!1),this.body.yy>q.GAMEHEIGHT&&!this.dead&&(this.body.setCoords(q.GAMEWIDTH/2,-5),this.bump=.9,this.onFire=!0)},Q.prototype.clear=function(){this.inUse=!1,this.body.xx=-1e3,this.body.xx=-1e3,this.body.dead=!0,this.body.collides=!1,this.body.mapcollide=!1,this.onFire=!1,this.bump=0},Q.prototype.render=function(a){a.fillStyle=this.onFire?this.angryFill:this.fill,a.strokeStyle=this.onFire?this.angryStroke:this.fill,a.save(),a.translate(.5,-3.5),a.fillRect(this.body.xx-this.body.radius,this.body.yy-this.body.radius-this.stride,2*this.body.radius,2*this.body.radius+this.stride),a.strokeRect(this.body.xx-this.body.radius,this.body.yy-this.body.radius-this.stride,2*this.body.radius,2*this.body.radius)+this.stride,a.restore(),a.fillStyle="#FFF",a.fillRect(this.body.xx-2,this.body.yy-4-this.stride2,this.onFire?2:1,2),a.fillRect(this.body.xx+2,this.body.yy-4-this.stride2,this.onFire?2:1,2),a.fillStyle="#Fa0",this.antennae&&(a.fillRect(this.body.xx-3,this.body.yy-11-this.stride2,1,5),a.fillRect(this.body.xx+3,this.body.yy-11-this.stride2,1,5))}}Glitchbox=function(){this.body=new Entity({radius:8,collides:!1,mapcollide:!0,gravity:.05}),this.body.setCoords(70,100),this.fl=!0,this.cooldown=0,this.justJumped=!1,this.justFired=!1,this.type="glitchbox",this.bump=0,this.locations=[{cx:10,cy:2},{cx:6,cy:2},{cx:2,cy:7},{cx:5,cy:7},{cx:8,cy:7},{cx:18,cy:7},{cx:24,cy:7},{cx:9,cy:12},{cx:14,cy:12},{cx:18,cy:12},{cx:2,cy:16},{cx:10,cy:17},{cx:18,cy:17},{cx:24,cy:16}]},Glitchbox.prototype.update=function(){this.bump>0&&(this.bump-=.01),q.GLITCH.xch=this.bump,n.get({x:this.body.xx-this.body.radius+1+15*Math.random(),y:this.body.yy-5,mapcollide:!1,gravity:-.006,radius:1,type:"glitch",life:1})},Glitchbox.prototype.render=function(a){a.fillStyle="#"+I("456789ABCDEF",3),Txt.text({ctx:a,x:this.body.xx-this.body.radius,y:this.body.yy-this.body.radius-3,text:"dos\noOo\neow",hspacing:-1,vspacing:-1,halign:"top",valign:"left",scale:1,snap:1,render:1,glitch:q.GLITCH})},Glitchbox.prototype.die=function(){this.bump=.5,b++,q.GLITCH.ych+=.005,T("glitchbox",this.body);var a=this.locations[Math.floor(H(0,this.locations.length-1))];glitchbox.body.setCoords(a.cx*q.GRID,a.cy*q.GRID)},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown:function(a){return this._pressed[a]},justReleased:function(a){return this._released[a]},onKeydown:function(a){this._pressed[a.keyCode]=!0},onKeyup:function(a){this._released[a.keyCode]=!0,delete this._pressed[a.keyCode]},update:function(){this._released={}}};var R={map:[[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,3,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,3,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,3,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1]],sounds:{jump:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:201,osc2_waveform:0,noise_fader:0,env_attack:7105,env_sustain:150,env_release:0,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:1,fx_delay_amt:16,fx_pan_freq:6,fx_pan_amt:128,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0},shoot:{osc1_oct:7,osc1_det:1,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:64,osc2_xenv:1,osc2_vol:192,osc2_waveform:2,noise_fader:27,env_attack:0,env_sustain:351,env_release:7916,env_master:135,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:1,fx_delay_amt:41,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0},boom:{osc1_oct:7,osc1_det:1,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:64,osc2_xenv:1,osc2_vol:192,osc2_waveform:2,noise_fader:115,env_attack:0,env_sustain:663,env_release:21074,env_master:135,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:1,fx_delay_amt:91,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0},engineSound4:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:39,osc2_xenv:1,osc2_vol:192,osc2_waveform:0,noise_fader:0,env_attack:193767,env_sustain:118467,env_release:2e5,env_master:192,fx_filter:4,fx_freq:2962,fx_resonance:143,fx_delay_time:1,fx_delay_amt:35,fx_pan_freq:1,fx_pan_amt:255,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:0,lfo_waveform:1},engineSound5:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:39,osc2_xenv:1,osc2_vol:192,osc2_waveform:0,noise_fader:0,env_attack:193767,env_sustain:118467,env_release:2e5,env_master:192,fx_filter:4,fx_freq:2962,fx_resonance:143,fx_delay_time:1,fx_delay_amt:35,fx_pan_freq:1,fx_pan_amt:255,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:0,lfo_waveform:1}},song:{songLen:36,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:234,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:219,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:255,fx_filter:4,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:152,lfo_waveform:0,p:[1,1,1,1,2,1,1,2,1,1],c:[{n:[123,0,123,0,126,0,126,0,128,0,128,0,0,0,0,0,123,0,123,0,126,0,126,0,128,0,128,0,0,0,0,0]},{n:[125,0,125,0,128,0,128,0,130,0,130,0,0,0,0,0,125,0,125,0,128,0,128,0,130,0,130,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:2193,env_release:351,env_master:184,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:4,fx_delay_amt:108,fx_pan_freq:3,fx_pan_amt:56,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,2,1,1,2],c:[{n:[135,0,0,0,138,0,0,0,140,0,0,0,0,0,0,0,147,0,0,0,150,0,0,0,152,0,0,0,0,0,0,0]},{n:[137,0,0,0,140,0,0,0,142,0,0,0,0,0,0,0,149,0,0,0,152,0,0,0,154,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:11,osc2_xenv:0,osc2_vol:192,osc2_waveform:3,noise_fader:29,env_attack:88,env_sustain:548,env_release:1584,env_master:228,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:4,fx_delay_amt:134,fx_pan_freq:7,fx_pan_amt:156,lfo_osc1_freq:1,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,2,1,2,3,2,1,3,1],c:[{n:[123,0,0,0,0,0,0,0,147,0,154,0,159,0,166,0,171,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,171,0,166,0,159,0,154,0,147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[125,0,0,0,0,0,0,0,149,0,156,0,161,0,168,0,173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:113,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:247,env_attack:41496,env_sustain:26863,env_release:91231,env_master:138,fx_filter:3,fx_freq:7640,fx_resonance:188,fx_delay_time:6,fx_delay_amt:124,fx_pan_freq:2,fx_pan_amt:115,lfo_osc1_freq:1,lfo_fx_freq:1,lfo_freq:5,lfo_amt:232,lfo_waveform:2,p:[0,1,0,1,0,1,0,1,1],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:49,env_sustain:3426,env_release:49,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:140,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[0,0,1,1,2,1,1,2],c:[{n:[123,123,135,135,126,126,138,138,128,128,140,140,133,133,145,145,123,123,135,135,126,126,138,138,128,128,140,140,130,130,142,142]},{n:[125,125,137,137,128,128,140,140,130,130,142,142,135,135,147,147,125,125,137,137,128,128,140,140,130,130,142,142,132,132,144,144]}]},{osc1_oct:5,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:214,osc1_waveform:0,osc2_oct:5,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:204,osc2_waveform:0,noise_fader:229,env_attack:50,env_sustain:6363,env_release:1818,env_master:158,fx_filter:3,fx_freq:7924,fx_resonance:240,fx_delay_time:6,fx_delay_amt:74,fx_pan_freq:4,fx_pan_amt:232,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:231,lfo_waveform:0,p:[0,0,0,0,1,1,1,1],c:[{n:[147,0,0,0,0,0,147,0,0,0,0,147,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:4,osc2_xenv:0,osc2_vol:192,osc2_waveform:3,noise_fader:0,env_attack:36863,env_sustain:35969,env_release:8772,env_master:192,fx_filter:1,fx_freq:3022,fx_resonance:255,fx_delay_time:4,fx_delay_amt:140,fx_pan_freq:3,fx_pan_amt:162,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:8,lfo_amt:255,lfo_waveform:0,p:[0,0,0,0,0,0,1,2,3],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,154,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[149,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,156,0,0,0,0,0,0,0,168,0,161,0,152,0,0,0]},{n:[171,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:4410,endPattern:11},titlesong:{rowLen:6963,endPattern:5,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:13,osc2_xenv:0,osc2_vol:192,osc2_waveform:3,noise_fader:0,env_attack:0,env_sustain:5614,env_release:0,env_master:28,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:1,fx_pan_amt:60,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:8,lfo_amt:191,lfo_waveform:2,p:[1,1,1,1],c:[{n:[123,0,0,123,0,0,123,123,123,121,0,121,0,0,121,121,121,120,0,120,0,0,120,120,119,0,0,118,0,0,114,113]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:29,env_attack:50,env_sustain:150,env_release:4800,env_master:195,fx_filter:2,fx_freq:600,fx_resonance:192,fx_delay_time:1,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:0,lfo_amt:0,lfo_waveform:2,p:[1,1,1,1],c:[{n:[123,0,0,0,123,0,0,0,123,0,0,0,123,0,0,0,123,0,0,0,123,0,0,0,123,0,0,0,123,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:82,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:255,env_attack:100,env_sustain:0,env_release:1234,env_master:186,fx_filter:3,fx_freq:10121,fx_resonance:64,fx_delay_time:0,fx_delay_amt:24,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1],c:[{n:[0,123,123,123,0,123,123,123,0,123,123,123,0,123,123,123,0,123,123,123,0,123,123,123,0,123,123,123,0,123,123,123]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:124,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:163,lfo_waveform:3,p:[1,2,1,2],c:[{n:[159,154,159,162,0,161,159,157,0,0,0,0,0,0,159,157,156,152,156,162,0,161,159,161,0,0,0,0,0,0,0,0]},{n:[166,164,162,159,0,154,162,159,161,157,154,0,0,154,159,154,155,154,152,147,0,149,150,149,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:221,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:210,osc2_waveform:3,noise_fader:255,env_attack:50,env_sustain:150,env_release:7505,env_master:127,fx_filter:3,fx_freq:7355,fx_resonance:206,fx_delay_time:2,fx_delay_amt:24,fx_pan_freq:1,fx_pan_amt:142,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:7,lfo_amt:64,lfo_waveform:0,p:[1,1,1,1],c:[{n:[0,0,0,0,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,123,0,0,0,0,0,0,0,123,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:160,osc2_waveform:0,noise_fader:0,env_attack:100,env_sustain:150,env_release:13636,env_master:59,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:6,fx_delay_amt:28,fx_pan_freq:6,fx_pan_amt:147,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:195,lfo_waveform:3,p:[1,1,1,1],c:[{n:[142,138,142,138,142,138,142,138,140,137,140,137,140,137,140,137,138,135,138,135,138,135,138,135,137,134,137,134,137,134,137,134]}]}],songLen:27},letters:{".":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,1,,0]],1:[[,1,1,,0],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],2:[[1,1,1,1,0],[,,,,1],[,1,1,1,0],[1,,,,0],[1,1,1,1,1]],3:[[1,1,1,1,0],[,,,,1],[,1,1,1,1],[,,,,1],[1,1,1,1,0]],4:[[1,,,1,0],[1,,,1,0],[1,1,1,1,1],[,,,1,0],[,,,1,0]],5:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,0],[,,,,1],[1,1,1,1,0]],6:[[,1,1,1,0],[1,,,,0],[1,1,1,1,0],[1,,,,1],[,1,1,1,0]],7:[[1,1,1,1,1],[,,,,1],[,,,1,0],[,,1,,0],[,,1,,0]],8:[[,1,1,1,0],[1,,,,1],[,1,1,1,0],[1,,,,1],[,1,1,1,0]],9:[[,1,1,1,0],[1,,,,1],[,1,1,1,1],[,,,,1],[,1,1,1,0]],0:[[,1,1,1,0],[1,,,,1],[1,,,,1],[1,,,,1],[,1,1,1,0]],
A:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],B:[[1,1,1,1,0],[1,,,1,0],[1,1,1,1,1],[1,,,,1],[1,1,1,1,1]],C:[[1,1,1,1,1],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],D:[[1,1,1,,0],[1,,,1,0],[1,,,,1],[1,,,,1],[1,1,1,1,1]],E:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,,,,0]],G:[[1,1,1,1,1],[1,,,,0],[1,,1,1,1],[1,,,,1],[1,1,1,1,1]],H:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],I:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],J:[[,,,,1],[,,,,1],[,,,,1],[1,,,,1],[1,1,1,1,1]],K:[[1,,,1,0],[1,,1,,0],[1,1,1,,0],[1,,,1,0],[1,,,,1]],L:[[1,,,,0],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],M:[[1,,,,1],[1,1,,1,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,,1],[1,1,,,1],[1,,1,,1],[1,,,1,1],[1,,,,1]],O:[[1,1,1,1,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],P:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,0],[1,,,,0]],Q:[[1,1,1,1,0],[1,,,1,0],[1,,,1,0],[1,,,1,0],[1,1,1,1,1]],R:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,1,0],[1,,,,1]],S:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,1],[,,,,1],[1,1,1,1,1]],T:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[,,1,,0]],U:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],V:[[1,,,,1],[1,,,,1],[1,,,,1],[,1,,1,0],[,,1,,0]],W:[[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,,1,1],[1,,,,1]],X:[[1,,,,1],[,1,,1,0],[,,1,,0],[,1,,1,0],[1,,,,1]],Y:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[,,1,,0],[,,1,,0]],Z:[[1,1,1,1,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,1,1,1,1]]," ":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,,,0]],",":[[,,,,0],[,,,,0],[,,,,0],[,,1,,0],[,,1,,0]],"+":[[,,,,0],[,,1,,0],[,1,1,1,0],[,,1,,0],[,,,,0]],"/":[[,,,,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,,,,0]],":":[[,,,,0],[,,1,,0],[,,,,0],[,,1,,0],[,,,,0]],"@":[[1,1,1,1,1],[,,,,1],[1,1,1,,1],[1,,1,,1],[1,1,1,1,1]],x:[[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1]],z:[[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0]],o:[[1,1,1,1,1],[1,,,,1],[1,,1,,1],[1,,,,1],[1,1,1,1,1]],e:[[1,,,,0],[1,1,,,0],[1,1,1,,0],[1,1,1,1,0],[1,1,1,1,1]],w:[[,,,,1],[,,,1,1],[,,1,1,1],[,1,1,1,1],[1,1,1,1,1]],s:[[1,1,1,1,1],[,1,1,1,1],[,,1,1,1],[,,,1,1],[,,,,1]],d:[[1,1,1,1,1],[1,1,1,1,0],[1,1,1,,0],[1,1,,,0],[1,,,,0]],t:[[0,0,0,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1]],y:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],u:[[1,1,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[1,1,1,0,0]],g:[[0,0,1,1,1],[0,0,0,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,1]],h:[[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[1,1,1,1,1],[1,1,1,1,1]],j:[[1,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]],b:[[0,0,0,1,1],[0,0,0,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],n:[[1,1,1,1,1],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],m:[[1,1,1,1,1],[1,0,0,1,1],[1,0,0,0,0],[1,0,0,0,0],[1,0,0,0,0]]}};Txt={textLine:function(a){gl=a.glitch||{};for(var b=a.text.length,c=5,d=0;b>d;d++)for(var e=R.letters[a.text.charAt(d)]||R.letters.unknown,f=0;c>f;f++)for(var g=0;c>g;g++)if(1===e[f][g]){var h=(Math.random()<gl.xch||0)*(Math.random()-.5)*gl.xamt||0,i=(Math.random()<gl.ych||0)*(Math.random()-.5)*gl.yamt||0;a.ctx.fillRect(a.x+g*a.scale+h+(c*a.scale+a.hspacing)*d,a.y+f*a.scale+i,a.scale,a.scale)}},text:function(a){var b=5,c=b*a.scale,d=a.text.split("\n"),e=d.slice(0),f=d.length,g=e.sort(function(a,b){return b.length-a.length})[0],h=g.length*c+(g.length-1)*a.hspacing,i=f*c+(f-1)*a.vspacing,j=a.x,k=a.y,l=a.x+h,m=a.y+i;"center"==a.halign?(j=a.x-h/2,l=a.x+h/2):"right"==a.halign&&(j=a.x-h,l=a.x),"center"==a.valign?(k=a.y-i/2,m=a.y+i/2):"bottom"==a.valign&&(k=a.y-i,m=a.y);var n=j+h/2,o=k+i/2;if(a.render)for(var p=0;f>p;p++){var q=d[p],r=q.length*c+(q.length-1)*a.hspacing,s=a.x,t=a.y+(c+a.vspacing)*p;"center"==a.halign?s=a.x-r/2:"right"==a.halign&&(s=a.x-r),"center"==a.valign?t-=i/2:"bottom"==a.valign&&(t-=i),a.snap&&(s=Math.floor(s),t=Math.floor(t)),this.textLine({ctx:a.ctx,x:s,y:t,text:q,hspacing:a.hspacing||0,scale:a.scale||1,glitch:a.glitch})}return{sx:j,sy:k,cx:n,cy:o,ex:l,ey:m,width:h,height:i}}};function S(){this.inUse=!1,this.init=function(){this.body=new Entity({dead:!0,gravity:0}),this.body.setCoords(-1e3,-1e3)},S.prototype.spawn=function(a){this.inUse=!0,this.type=a.type,this.text=a.text,this.ctx=a.ctx,this.life=a.life||1,this.remaining=a.life||1,this.body.radius=a.radius||1,this.body.collides=a.collides||!1,this.body.mapcollide=a.mapcollide||!1,this.color=a.color||"#fff",this.asplode=a.asplode,this.body.dead=!1,this.dead=!1,this.body.setCoords(a.x,a.y),this.body.dx=a.dx||0,this.body.dy=a.dy||0,this.body.gravity=a.gravity||0,this.body.type=a.type||"particle"},S.prototype.use=function(a){return this.dead?(T("default",this.body),T("smoke",this.body),!0):(this.remaining-=a,this.remaining>0?(this.render(z),this.body.dx+=Math.random()*q.GLITCH.xch-q.GLITCH.xch/2,this.body.dy+=Math.random()*q.GLITCH.xch-q.GLITCH.xch/2,this.body.update(),!1):(this.dead=!0,!0))},S.prototype.clear=function(){this.inUse=!1,this.body.xx=-1e3,this.body.xx=-1e3,this.body.dead=!0,this.body.collides=!1,this.body.mapcollide=!1},S.prototype.render=function(a){var b=this.body;switch(this.ctx&&(a=this.ctx),this.type){case"glitch":a.save(),a.globalCompositeOperation="screen",a.fillStyle="#"+I("5678890ABCDE",3),a.strokeStyle=this.stroke;var c=this.body.radius*(this.remaining/this.life);a.fillRect(b.xx,b.yy-c,2*c,2*c),a.restore();break;case"text":a.fillStyle=this.color,Txt.text({ctx:B,x:b.xx,y:b.yy,text:"o",hspacing:2,vspacing:5,halign:"center",valign:"top",scale:1,snap:1,render:1});break;case"smoke":var d=this.remaining/this.life;a.fillStyle="rgba(200,200,200,"+d+")",a.fillRect(b.xx-this.body.radius,b.yy-this.body.radius,2*this.body.radius,2*this.body.radius);break;default:a.save(),a.globalCompositeOperation="screen",a.fillStyle=this.color||"#fff",a.strokeStyle=this.stroke;var c=this.body.radius*(this.remaining/this.life);a.fillRect(b.xx,b.yy-c,2*c,2*c),a.restore()}}}function T(a,b){switch(a){default:for(var c=20;c--;)n.get({x:b.xx||100,y:b.yy||100,mapcollide:!1,dy:2*Math.random()-1,dx:2*Math.random()-1,radius:3,color:"#e80",life:.25});break;case"enemy":for(var c=10;c--;)n.get({x:b.xx||100,y:b.yy||100,mapcollide:!1,gravity:.03,dy:2*Math.random()-1,dx:2*Math.random()-1,radius:3,color:"#800",life:.2});break;case"smoke":for(var c=10;c--;)n.get({x:b.xx+6*Math.random()-3||100,y:b.yy+6*Math.random()-3||100,mapcollide:!1,type:"smoke",gravity:-.003,dy:Math.random()*-.1,dx:.1*Math.random()-.05,radius:5,life:.75})}}function U(a,b){var c=a,d=[];this.init=function(){for(var a=0;c>a;a++){var e=new b;e.init(),d[a]=e}},this.get=function(a){return d[c-1].inUse?void 0:(d[c-1].spawn(a),d.unshift(d.pop()),d[c-1])},this.getPool=function(){return d},this.use=function(){for(var a=0;c>a&&d[a].inUse;a++)d[a].use(g)&&(d[a].clear(),d.push(d.splice(a,1)[0]))}}Entity=function(a){a||(a={radius:10,gravity:0,frictX:.92,frictY:.94}),this.cx=0,this.cy=0,this.xr=0,this.yr=0,this.xx=0,this.yy=0,this.dx=0,this.dy=0,this.collided=!1,this.ox=0,this.oy=0,this.radius=a.radius||10,this.gravity=a.gravity||0,this.bounce=a.bounce||0,this.frictX=a.frictX||.92,this.frictY=a.frictY||.94,this.dead=!1,this.collides=a.collides||0,this.mapcollide=a.mapcollide||0,this.id=Math.random()},Entity.prototype.setCoords=function(a,b){this.xx=a,this.yy=b,this.cx=Math.floor(this.xx/q.GRID),this.cy=Math.floor(this.yy/q.GRID),this.xr=(this.xx-this.cx*q.GRID)/q.GRID,this.yr=(this.yy-this.cy*q.GRID)/q.GRID},Entity.prototype.hasCollision=function(a,b){return this.mapcollide?void 0==R.map[b]||void 0==R.map[b][a]?!1:R.map[b][a]:!1},Entity.prototype.overlaps=function(a,b){var c=a.radius+b.radius,d=(b.xx-a.xx)*(b.xx-a.xx)+(b.yy-a.yy)*(b.yy-a.yy);return d>c*c?!1:!0},Entity.prototype.onGround=function(){return this.hasCollision(this.cx,this.cy+1)&&this.yr>=.5},Entity.prototype.onCeiling=function(){return this.hasCollision(this.cx,this.cy-1)&&this.yr<=.5},Entity.prototype.onWallLeft=function(){return this.hasCollision(this.cx-1,this.cy)&&this.xr<=.5},Entity.prototype.onWallRight=function(){return this.hasCollision(this.cx+1,this.cy)&&this.xr>=.5},Entity.prototype.update=function(){for(this.xr+=this.dx,this.dx*=this.frictX,this.hasCollision(this.cx-1,this.cy)&&this.xr<=.3&&(this.dx=0,this.xr=.3),this.hasCollision(this.cx+1,this.cy)&&this.xr>=.7&&(this.dx=0,this.xr=.7);this.xr<0;)this.cx--,this.xr++;for(;this.xr>1;)this.cx++,this.xr--;for(this.dy+=this.gravity,this.yr+=this.dy,this.dy*=this.frictY,this.hasCollision(this.cx,this.cy-1)&&this.yr<=.4&&(this.dy=0,this.yr=.4),this.hasCollision(this.cx,this.cy+1)&&this.yr>=.7&&(this.dy=this.bounce?-this.dy:0,this.bounce||(this.yr=.7));this.yr<0;)this.cy--,this.yr++;for(;this.yr>1;)this.cy++,this.yr--;this.xx=Math.floor((this.cx+this.xr)*q.GRID),this.yy=Math.floor((this.cy+this.yr)*q.GRID),this.ox=(this.cx+this.xr)*q.GRID,this.oy=(this.cy+this.yr)*q.GRID},Entity.prototype.collide=function(a,b){var c=Math.sqrt((a.xx-b.xx)*(a.xx-b.xx)+(a.yy-b.yy)*(a.yy-b.yy));if(c<=a.radius+b.radius){this.collided=!0;var d=Math.atan2(a.yy-b.yy,a.xx-b.xx),f=.03,g=(b.radius+a.radius-c)/(b.radius+a.radius);this.dx-=Math.cos(d)*g*f,this.dy-=Math.sin(d)*g*f,e.dx+=Math.cos(d)*g*f,e.dy+=Math.sin(d)*g*f}};var V={},W=44100,X=2,Y=33,Z=null;function $(a){return Math.sin(6.283184*a)}function _(a){return $(a)<0?-1:1}function aa(a){return a%1-.5}function ba(a){var b=a%1*4;return 2>b?b-1:3-b}var ca=[$,_,aa,ba];function da(a){return.00390625*Math.pow(1.059463094,a-128)}function ea(a,b){setTimeout(function(){var c=new Uint8Array(a*X*2),d=c.length-2,e=function(){for(var a=new Date,f=0;d>=0;)if(c[d]=0,c[d+1]=128,d-=2,f+=1,f%1e3===0&&new Date-a>Y)return void setTimeout(e,0);setTimeout(function(){b(c)},0)};setTimeout(e,0)},0)}function fa(a,b,c,d,e){var f=c.fx_delay_time*d>>1,g=c.fx_delay_amt/255,h=0,i=function(){for(var c=new Date,d=0;b-f>h;){var j=4*h,k=4*(h+f),l=a[k]+(a[k+1]<<8)+(a[j+2]+(a[j+3]<<8)-32768)*g;if(a[k]=255&l,a[k+1]=l>>8&255,l=a[k+2]+(a[k+3]<<8)+(a[j]+(a[j+1]<<8)-32768)*g,a[k+2]=255&l,a[k+3]=l>>8&255,++h,d+=1,d%1e3===0&&new Date-c>Y)return void setTimeout(i,0)}setTimeout(e,0)};setTimeout(i,0)}V.AudioGenerator=function(a){this.mixBuf=a,this.waveSize=a.length/X/2},V.AudioGenerator.prototype.getWave=function(){var a,b,c,d,e,f,g,h=this.mixBuf,i=this.waveSize,j=i*X*2;for(e=j-8,f=e-36,d=String.fromCharCode(82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&f,f>>8&255,f>>16&255,f>>24&255),a=0;j>a;){for(c="",b=0;256>b&&j>a;++b,a+=2)g=4*(h[a]+(h[a+1]<<8)-32768),g=-32768>g?-32768:g>32767?32767:g,c+=String.fromCharCode(255&g,g>>8&255);d+=c}return d},V.AudioGenerator.prototype.getAudio=function(){var a=this.getWave(),b=new Audio("data:audio/wav;base64,"+btoa(a));return b.preload="none",b.load(),b},V.AudioGenerator.prototype.getAudioBuffer=function(a){null===Z&&(Z=new AudioContext);var b=this.mixBuf,c=this.waveSize,d=c*X*2,e=Z.createBuffer(X,this.waveSize,W),f=e.getChannelData(0),g=e.getChannelData(1),h=0,i=function(){for(var c=new Date,j=0;d/2>h;){var k=4*(b[4*h]+(b[4*h+1]<<8)-32768);if(k=-32768>k?-32768:k>32767?32767:k,f[h]=k/32768,k=4*(b[4*h+2]+(b[4*h+3]<<8)-32768),k=-32768>k?-32768:k>32767?32767:k,g[h]=k/32768,h+=1,j+=1,j%1e3===0&&new Date-c>Y)return void setTimeout(i,0)}setTimeout(function(){a(e)},0)};setTimeout(i,0)},V.SoundGenerator=function(a,b){this.instr=a,this.rowLen=b||5605,this.osc_lfo=ca[a.lfo_waveform],this.osc1=ca[a.osc1_waveform],this.osc2=ca[a.osc2_waveform],this.attack=a.env_attack,this.sustain=a.env_sustain,this.release=a.env_release,this.panFreq=Math.pow(2,a.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,a.lfo_freq-8)/this.rowLen},V.SoundGenerator.prototype.genSound=function(a,b,c){for(var d=(new Date,0),e=0,f=da(a+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),g=da(a+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),h=this.instr.fx_resonance/255,i=0,j=0,k=this.attack+this.sustain+this.release-1;k>=0;--k){var l=k+c,m=this.osc_lfo(l*this.lfoFreq)*this.instr.lfo_amt/512+.5,n=1;k<this.attack?n=k/this.attack:k<this.attack+this.sustain||(n-=(k-this.attack-this.sustain)/this.release);var o=f;this.instr.lfo_osc1_freq&&(o+=m),this.instr.osc1_xenv&&(o*=n*n),d+=o;var p=this.osc1(d)*this.instr.osc1_vol;o=g,this.instr.osc2_xenv&&(o*=n*n),e+=o,p+=this.osc2(e)*this.instr.osc2_vol,this.instr.noise_fader&&(p+=(2*Math.random()-1)*this.instr.noise_fader*n),p*=n/255;var q=this.instr.fx_freq;this.instr.lfo_fx_freq&&(q*=m),q=1.5*Math.sin(3.141592*q/W),i+=q*j;var r=h*(p-j)-i;switch(j+=q*r,this.instr.fx_filter){case 1:p=r;break;case 2:p=i;break;case 3:p=j;break;case 4:p=i+r}if(o=$(l*this.panFreq)*this.instr.fx_pan_amt/512+.5,p*=39*this.instr.env_master,l=4*l,l+3<b.length){var s=b[l]+(b[l+1]<<8)+p*(1-o);b[l]=255&s,b[l+1]=s>>8&255,s=b[l+2]+(b[l+3]<<8)+p*o,b[l+2]=255&s,b[l+3]=s>>8&255}}},V.SoundGenerator.prototype.getAudioGenerator=function(a,b){var c=this.attack+this.sustain+this.release-1+32*this.rowLen,d=this;ea(c,function(e){d.genSound(a,e,0),fa(e,c,d.instr,d.rowLen,function(){b(new V.AudioGenerator(e))})})},V.SoundGenerator.prototype.createAudio=function(a,b){this.getAudioGenerator(a,function(a){b(a.getAudio())})},V.SoundGenerator.prototype.createAudioBuffer=function(a,b){this.getAudioGenerator(a,function(a){a.getAudioBuffer(b)})},V.MusicGenerator=function(a){this.song=a,this.waveSize=W*a.songLen},V.MusicGenerator.prototype.generateTrack=function(a,b,c){var d=this;ea(this.waveSize,function(e){var f=d.waveSize,g=d.waveSize*X*2,h=d.song.rowLen,i=d.song.endPattern,j=new V.SoundGenerator(a,h),k=0,l=0,m=0,n=function(){for(var b=new Date;;)if(32!==m){if(l===i-1)return void setTimeout(o,0);var c=a.p[l];if(c){var d=a.c[c-1].n[m];d&&j.genSound(d,e,k)}if(k+=h,m+=1,new Date-b>Y)return void setTimeout(n,0)}else m=0,l+=1},o=function(){fa(e,f,a,h,q)},p=0,q=function(){for(var a=new Date,d=0;g>p;){var f=b[p]+(b[p+1]<<8)+e[p]+(e[p+1]<<8)-32768;if(b[p]=255&f,b[p+1]=f>>8&255,p+=2,d+=1,d%1e3===0&&new Date-a>Y)return void setTimeout(q,0)}setTimeout(c,0)};setTimeout(n,0)})},V.MusicGenerator.prototype.getAudioGenerator=function(a){var b=this;ea(this.waveSize,function(c){var d=0,e=function(){d<b.song.songData.length?(d+=1,b.generateTrack(b.song.songData[d-1],c,e)):a(new V.AudioGenerator(c))};e()})},V.MusicGenerator.prototype.createAudio=function(a){this.getAudioGenerator(function(b){a(b.getAudio())})},V.MusicGenerator.prototype.createAudioBuffer=function(a){this.getAudioGenerator(function(b){b.getAudioBuffer(a)})},window.onload=K()}();
</script></body></html>