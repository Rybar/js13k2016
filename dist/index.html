<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ryan's JS13k Game</title><style>
body{background:#000}#gamecontainer{margin:0 auto}#game{margin:0 auto;width:600px;border:1px solid #555}canvas{border:1px solid #555;margin:10px;cursor:crosshair;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}
</style></head><body><div id="gamecontainer"><canvas id="game" width="600" height="600"></canvas></div><script>
var GAME=function(){var a=[],b=60,c=1/b,d=0,e=v(),f=v(),g={},h={},i=document.querySelector("#game"),j=i.getContext("2d");j.imageSmoothingEnabled=!1,j.fillStyle="#0F0";var k=document.createElement("canvas");k.width=200,k.height=200;var l=k.getContext("2d");l.imageSmoothingEnabled=!1,l.mozImageSmoothingEnabled=!1;var m=document.createElement("canvas");m.width=200,m.height=200;var n=m.getContext("2d");n.imageSmoothingEnabled=!1,n.mozImageSmoothingEnabled=!1;var o=document.createElement("canvas");o.width=200,o.height=200;var p=o.getContext("2d");p.imageSmoothingEnabled=!1,p.mozImageSmoothingEnabled=!1;var q=document.createElement("canvas");q.width=200,q.height=200;var r=q.getContext("2d");r.imageSmoothingEnabled=!1,r.mozImageSmoothingEnabled=!1;var s={GAMEWIDTH:200,GAMEHEIGHT:200,SCALE:3,GRID:10,WIDTH:20,HEIGHT:20,P_SPEED:1,P_JUMP:.5,E_SPEED:.2,E_JUMP:.25,GLITCH:0,GLITCHFACTOR:0},t={render:function(a){for(var b=A.map,c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++)a.fillStyle="#779",b[c][d]&&Txt.text({ctx:a,x:d*s.GRID,y:c*s.GRID,text:"ox\nxo",hspacing:0,vspacing:0,halign:"top",valign:"left",scale:1,snap:1,render:1,glitchChance:s.GLITCH,glitchFactor:s.GLITCHFACTOR})}};function u(){h=y.create({initial:"init",events:[{name:"load",from:"init",to:"boot"},{name:"ready",from:"boot",to:"menu"},{name:"play",from:"menu",to:"game"},{name:"lose",from:"game",to:"gameover"},{name:"reset",from:["init","boot","menu","gameover","game"],to:"boot"}],callbacks:{onenterboot:function(a,b,c){z.boot.onenter(a,b,c)},onentermenu:function(a,b,c){z.menu.onenter(a,b,c)},onleavemenu:function(a,b,c){z.menu.onexit(a,b,c)},onentergame:function(a,b,c){z.game.onenter(a,b,c)},onleavegame:function(a,b,c){z.onexit(a,b,c)}}}),window.addEventListener("keyup",function(a){Key.onKeyup(a)},!1),window.addEventListener("keydown",function(a){Key.onKeydown(a)},!1),h.load(),w()}function v(){return(new Date).getTime()}initAudio=function(){g.loaded=0,g.total=7,window.AudioContext=window.AudioContext||window.webkitAudioContext,F=new AudioContext,soundGen=new B.SoundGenerator(A.sounds.jump),soundGen.createAudioBuffer(171,function(a){g.loaded++,g.jump=a}),soundGen=new B.SoundGenerator(A.sounds.engineSound2),soundGen.createAudioBuffer(171,function(a){g.loaded++,g.es2=a}),soundGen=new B.SoundGenerator(A.sounds.engineSound3),soundGen.createAudioBuffer(171,function(a){g.loaded++,g.es3=a}),soundGen=new B.SoundGenerator(A.sounds.engineSound4),soundGen.createAudioBuffer(171,function(a){g.loaded++,g.es4=a}),soundGen=new B.SoundGenerator(A.sounds.engineSound5),soundGen.createAudioBuffer(171,function(a){g.loaded++,g.es5=a}),soundGen=new B.MusicGenerator(A.song),soundGen.createAudioBuffer(function(a){g.song=a,g.loaded++}),soundGen=new B.MusicGenerator(A.titlesong),soundGen.createAudioBuffer(function(a){g.titlesong=a,g.loaded++})};function w(){for(e=v(),d+=Math.min(1,(e-f)/1e3);d>c;)d-=c,z[h.current].update(c);z[h.current].render(n),f=e,r.drawImage(k,0,0),r.drawImage(m,0,0),r.drawImage(o,0,0),j.clearRect(0,0,s.GAMEWIDTH*s.SCALE,s.GAMEHEIGHT*s.SCALE),j.drawImage(q,0,0,s.GAMEWIDTH,s.GAMEHEIGHT,0,0,s.GAMEWIDTH*s.SCALE,s.GAMEHEIGHT*s.SCALE),requestAnimationFrame(w)}function x(){r.clearRect(0,0,s.GAMEWIDTH,s.GAMEHEIGHT),l.clearRect(0,0,s.GAMEWIDTH,s.GAMEHEIGHT),n.clearRect(0,0,s.GAMEWIDTH,s.GAMEHEIGHT),p.clearRect(0,0,s.GAMEWIDTH,s.GAMEHEIGHT)}var y={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,b){var c="string"==typeof a.initial?{state:a.initial}:a.initial,d=a.terminal||a.final,e=b||a.target||{},f=a.events||[],g=a.callbacks||{},h={},i={},j=function(a){var b=a.from instanceof Array?a.from:a.from?[a.from]:[y.WILDCARD];h[a.name]=h[a.name]||{};for(var c=0;c<b.length;c++)i[b[c]]=i[b[c]]||[],i[b[c]].push(a.name),h[a.name][b[c]]=a.to||b[c]};c&&(c.event=c.event||"startup",j({name:c.event,from:"none",to:c.state}));for(var k=0;k<f.length;k++)j(f[k]);for(var l in h)h.hasOwnProperty(l)&&(e[l]=y.buildEvent(l,h[l]));for(var l in g)g.hasOwnProperty(l)&&(e[l]=g[l]);return e.current="none",e.is=function(a){return a instanceof Array?a.indexOf(this.current)>=0:this.current===a},e.can=function(a){return!this.transition&&(h[a].hasOwnProperty(this.current)||h[a].hasOwnProperty(y.WILDCARD))},e.cannot=function(a){return!this.can(a)},e.transitions=function(){return i[this.current]},e.isFinished=function(){return this.is(d)},e.error=a.error||function(a,b,c,d,e,f,g){throw g||f},c&&!c.defer&&e[c.event](),e},doCallback:function(a,b,c,d,e,f){if(b)try{return b.apply(a,[c,d,e].concat(f))}catch(g){return a.error(c,d,e,f,y.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",g)}},beforeAnyEvent:function(a,b,c,d,e){return y.doCallback(a,a.onbeforeevent,b,c,d,e)},afterAnyEvent:function(a,b,c,d,e){return y.doCallback(a,a.onafterevent||a.onevent,b,c,d,e)},leaveAnyState:function(a,b,c,d,e){return y.doCallback(a,a.onleavestate,b,c,d,e)},enterAnyState:function(a,b,c,d,e){return y.doCallback(a,a.onenterstate||a.onstate,b,c,d,e)},changeState:function(a,b,c,d,e){return y.doCallback(a,a.onchangestate,b,c,d,e)},beforeThisEvent:function(a,b,c,d,e){return y.doCallback(a,a["onbefore"+b],b,c,d,e)},afterThisEvent:function(a,b,c,d,e){return y.doCallback(a,a["onafter"+b]||a["on"+b],b,c,d,e)},leaveThisState:function(a,b,c,d,e){return y.doCallback(a,a["onleave"+c],b,c,d,e)},enterThisState:function(a,b,c,d,e){return y.doCallback(a,a["onenter"+d]||a["on"+d],b,c,d,e)},beforeEvent:function(a,b,c,d,e){return!1===y.beforeThisEvent(a,b,c,d,e)||!1===y.beforeAnyEvent(a,b,c,d,e)?!1:void 0},afterEvent:function(a,b,c,d,e){y.afterThisEvent(a,b,c,d,e),y.afterAnyEvent(a,b,c,d,e)},leaveState:function(a,b,c,d,e){var f=y.leaveThisState(a,b,c,d,e),g=y.leaveAnyState(a,b,c,d,e);return!1===f||!1===g?!1:y.ASYNC===f||y.ASYNC===g?y.ASYNC:void 0},enterState:function(a,b,c,d,e){y.enterThisState(a,b,c,d,e),y.enterAnyState(a,b,c,d,e)},buildEvent:function(a,b){return function(){var c=this.current,d=b[c]||b[y.WILDCARD]||c,e=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,c,d,e,y.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,c,d,e,y.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===y.beforeEvent(this,a,c,d,e))return y.Result.CANCELLED;if(c===d)return y.afterEvent(this,a,c,d,e),y.Result.NOTRANSITION;var f=this;this.transition=function(){return f.transition=null,f.current=d,y.enterState(f,a,c,d,e),y.changeState(f,a,c,d,e),y.afterEvent(f,a,c,d,e),y.Result.SUCCEEDED},this.transition.cancel=function(){f.transition=null,y.afterEvent(f,a,c,d,e)};var g=y.leaveState(this,a,c,d,e);return!1===g?(this.transition=null,y.Result.CANCELLED):y.ASYNC===g?y.Result.PENDING:this.transition?this.transition():void 0}}},z={boot:{onenter:function(){},render:function(){x(GAME),a=[];var b=["INITIALIZING","RENDERING SOUNDS...","CONFIGURATING PIXELS....","RETICULATING SPLINES...","MESSAGE 42","PREPARING ENEMIES...","ALMOST THERE...","READY. PRESS A TO CONTINUE"];j.clearRect(0,0,s.GAMEWIDTH,s.GAMEHEIGHT),p.fillStyle="#0f0",Txt.text({ctx:p,x:20,y:20,text:b[7],hspacing:2,vspacing:1,halign:"top",valign:"left",scale:1,snap:1,render:1,glitchChance:0,glitchFactor:0})},update:function(){Key.isDown(Key.r)&&h.current&&h.reset(),Key.isDown(Key.a)&&"boot"==h.current&&h.ready()}},menu:{onenter:function(a){},onexit:function(){},render:function(){x(GAME),ctxbfillStyle="#444",j.fillStyle="#fff",Txt.text({ctx:p,x:20,y:20,text:"GLITCHBOX\nPRESS S TO CONTINUE",hspacing:2,vspacing:1,halign:"top",valign:"center",scale:1,snap:1,render:1,glitchChance:.01,glitchFactor:2})},update:function(){Key.isDown(Key.r)&&h.current&&h.reset(),Key.isDown(Key.s)&&(j.fillStyle="#00ff00","menu"==h.current&&h.play())}},game:{onenter:function(b){switch(b){case"play":player=new Player({x:100,y:100}),a.push(player);for(var c=10;c--;){var d=new Enemy({x:Math.floor(200*Math.random()),y:Math.floor(200*Math.random()),radius:Math.abs(Math.floor(2*Math.random())+4)});a.push(d)}for(var e=40;e--;){var f=new Particle({x:Math.floor(200*Math.random()),y:Math.floor(200*Math.random()),radius:3,life:5,color:"#ff0"});a.push(f)}}},onexit:function(){},render:function(){x(GAME),l.fillStyle="#223",Txt.text({ctx:l,x:0,y:0,text:"xzxz\nzxzx\nxzxz\nzxzx",hspacing:0,vspacing:0,halign:"top",valign:"left",scale:10,snap:1,render:1,glitchChance:.05+s.GLITCH,glitchFactor:.05+s.GLITCHFACTOR}),Txt.text({ctx:p,x:10,y:10,text:"WASD OR ARROWS TO MOVE",hspacing:2,vspacing:1,halign:"top",valign:"left",scale:1,snap:1,render:1,glitchChance:.4,glitchFactor:.5}),t.render(n),a.forEach(function(a){a.render(n)})},update:function(b){Key.isDown(Key.r)&&h.current&&h.reset(),Key.isDown(Key.f)&&(s.GLITCH+=.01),Key.isDown(Key.p)&&(s.GLITCHFACTOR+=.01),a.forEach(function(a){a.update(b),a.body.update(b)})}},gameover:{render:function(a){a.clearRect(0,0,s.GAMEWIDTH,s.GAMEHEIGHT),Txt.text({ctx:a,x:64,y:128,text:"GAME OVER\nPRESS X TO PLAY AGAIN\nPRESS Z FOR MENU",hspacing:5,vspacing:5,halign:"top",valign:"left",scale:4,snap:1,render:1,glitchChance:.01,glitchFactor:2})},update:function(){Key.isDown(Key.r)&&h.current&&h.reset(),Key.isDown(Key.s)&&"gameover"==h.current&&h.play()}}};Player=function(b){this.body=new Entity({radius:10,type:"player",collides:!0,mapcollide:!0,gravity:.05}),this.body.setCoords(b.x,b.y),Player.prototype.update=function(b){Key.isDown(Key.LEFT)||Key.isDown(Key.a)?player.body.dx-=s.P_SPEED*b:(Key.isDown(Key.RIGHT)||Key.isDown(Key.d))&&(player.body.dx+=s.P_SPEED*b),Key.isDown(Key.UP)||Key.isDown(Key.w)?(player.body.dy=-s.P_JUMP,a.push(new Particle({x:this.body.xx+this.body.radius,y:this.body.yy-5,gravity:.001,dy:-this.body.dy,dx:Math.random(),radius:3,life:.5}))):(Key.isDown(Key.DOWN)||Key.isDown(Key.s))&&(player.body.dy+=s.P_SPEED*b)},Player.prototype.render=function(a){a.fillStyle="#0f0",Txt.text({ctx:a,x:this.body.xx-this.body.radius,y:this.body.yy-this.body.radius,text:"we\nsd",hspacing:0,vspacing:0,halign:"top",valign:"left",scale:1,snap:1,render:1,glitch:{xch:2,xamt:1,ych:2,yamt:1}})}},Enemy=function(a){this.opt=a,this.body=new Entity({radius:a.radius,type:"enemy",collides:!1,mapcollide:!0,gravity:.06}),this.color="#f00",this.movingLeft=!0,this.stridetick=0,this.antennae=Math.random()>.5,this.fill="#"+"456789ABCDEF".charAt(Math.floor(12*Math.random()))+"00",this.stroke="#"+"456789ABCDEF".charAt(Math.floor(12*Math.random()))+"00",this.body.setCoords(a.x,a.y)},Enemy.prototype.update=function(a){this.stridetick+=.3,this.stride=2*Math.sin(this.stridetick),this.stride2=1.3*Math.sin(this.stridetick-.8),this.movingLeft?this.body.dx-=s.E_SPEED*a:this.body.dx+=s.E_SPEED*a,this.body.onWallLeft()&&(this.movingLeft=!1),this.body.onWallRight()&&(this.movingLeft=!0),this.body.collided&&(this.movingLeft=!this.movingLeft,this.body.collided=!1),this.body.yy>s.GAMEHEIGHT&&this.body.setCoords(100,-5)},Enemy.prototype.render=function(a){return a.fillStyle=this.fill,a.strokeStyle=this.stroke,a.save(),a.translate(.5,-3.5),a.fillRect(this.body.xx-this.body.radius,this.body.yy-this.body.radius-this.stride,2*this.body.radius,2*this.body.radius),a.strokeRect(this.body.xx-this.body.radius,this.body.yy-this.body.radius-this.stride,2*this.body.radius,2*this.body.radius),a.restore(),a.fillStyle="#FFF",a.fillRect(this.body.xx-2,this.body.yy-4-this.stride2,1,2),a.fillRect(this.body.xx+2,this.body.yy-4-this.stride2,1,2),a.fillStyle="#Fa0",this.antennae&&(a.fillRect(this.body.xx-3,this.body.yy-11-this.stride2,1,5),a.fillRect(this.body.xx+3,this.body.yy-11-this.stride2,1,5)),this},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown:function(a){return this._pressed[a]},justReleased:function(a){return this._released[a]},onKeydown:function(a){this._pressed[a.keyCode]=!0},onKeyup:function(a){this._released[a.keyCode]=!0,delete this._pressed[a.keyCode]},update:function(){this._released={}}};var A={map:[[1,1,1,1,1,1,1,1,,,,,1,1,1,1,1,1,1,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,1,1,1,1,1,1,1,1,1,1,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,1,1,1,1,,,,,,,,,,,1,1,1,1,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,,,,,,,,,,,,,,,,,,,1],[1,1,1,1,1,1,1,1,,,,,1,1,1,1,1,1,1,1]],sounds:{jump:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:201,osc2_waveform:0,noise_fader:0,env_attack:7105,env_sustain:150,env_release:0,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:1,fx_delay_amt:16,fx_pan_freq:6,fx_pan_amt:128,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0},engineSound2:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:39,osc2_xenv:1,osc2_vol:192,osc2_waveform:0,noise_fader:0,env_attack:193767,env_sustain:118467,env_release:2e5,env_master:192,fx_filter:4,fx_freq:2962,fx_resonance:143,fx_delay_time:1,fx_delay_amt:35,fx_pan_freq:1,fx_pan_amt:255,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:0,lfo_waveform:1},engineSound3:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:39,osc2_xenv:1,osc2_vol:192,osc2_waveform:0,noise_fader:0,env_attack:193767,env_sustain:118467,env_release:2e5,env_master:192,fx_filter:4,fx_freq:2962,fx_resonance:143,fx_delay_time:1,fx_delay_amt:35,fx_pan_freq:1,fx_pan_amt:255,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:0,lfo_waveform:1},engineSound4:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:39,osc2_xenv:1,osc2_vol:192,osc2_waveform:0,noise_fader:0,env_attack:193767,env_sustain:118467,env_release:2e5,env_master:192,fx_filter:4,fx_freq:2962,fx_resonance:143,fx_delay_time:1,fx_delay_amt:35,fx_pan_freq:1,fx_pan_amt:255,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:0,lfo_waveform:1},engineSound5:{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:39,osc2_xenv:1,osc2_vol:192,osc2_waveform:0,noise_fader:0,env_attack:193767,env_sustain:118467,env_release:2e5,env_master:192,fx_filter:4,fx_freq:2962,fx_resonance:143,fx_delay_time:1,fx_delay_amt:35,fx_pan_freq:1,fx_pan_amt:255,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:0,lfo_waveform:1}},song:{songLen:36,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:234,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:219,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:255,fx_filter:4,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:152,lfo_waveform:0,p:[1,1,1,1,2,1,1,2,1,1],c:[{n:[123,0,123,0,126,0,126,0,128,0,128,0,0,0,0,0,123,0,123,0,126,0,126,0,128,0,128,0,0,0,0,0]},{n:[125,0,125,0,128,0,128,0,130,0,130,0,0,0,0,0,125,0,125,0,128,0,128,0,130,0,130,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:2193,env_release:351,env_master:184,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:4,fx_delay_amt:108,fx_pan_freq:3,fx_pan_amt:56,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,2,1,1,2],c:[{n:[135,0,0,0,138,0,0,0,140,0,0,0,0,0,0,0,147,0,0,0,150,0,0,0,152,0,0,0,0,0,0,0]},{n:[137,0,0,0,140,0,0,0,142,0,0,0,0,0,0,0,149,0,0,0,152,0,0,0,154,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:11,osc2_xenv:0,osc2_vol:192,osc2_waveform:3,noise_fader:29,env_attack:88,env_sustain:548,env_release:1584,env_master:228,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:4,fx_delay_amt:134,fx_pan_freq:7,fx_pan_amt:156,lfo_osc1_freq:1,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,2,1,2,3,2,1,3,1],c:[{n:[123,0,0,0,0,0,0,0,147,0,154,0,159,0,166,0,171,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,171,0,166,0,159,0,154,0,147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[125,0,0,0,0,0,0,0,149,0,156,0,161,0,168,0,173,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:113,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:247,env_attack:41496,env_sustain:26863,env_release:91231,env_master:138,fx_filter:3,fx_freq:7640,fx_resonance:188,fx_delay_time:6,fx_delay_amt:124,fx_pan_freq:2,fx_pan_amt:115,lfo_osc1_freq:1,lfo_fx_freq:1,lfo_freq:5,lfo_amt:232,lfo_waveform:2,p:[0,1,0,1,0,1,0,1,1],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:49,env_sustain:3426,env_release:49,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:140,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[0,0,1,1,2,1,1,2],c:[{n:[123,123,135,135,126,126,138,138,128,128,140,140,133,133,145,145,123,123,135,135,126,126,138,138,128,128,140,140,130,130,142,142]},{n:[125,125,137,137,128,128,140,140,130,130,142,142,135,135,147,147,125,125,137,137,128,128,140,140,130,130,142,142,132,132,144,144]}]},{osc1_oct:5,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:214,osc1_waveform:0,osc2_oct:5,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:204,osc2_waveform:0,noise_fader:229,env_attack:50,env_sustain:6363,env_release:1818,env_master:158,fx_filter:3,fx_freq:7924,fx_resonance:240,fx_delay_time:6,fx_delay_amt:74,fx_pan_freq:4,fx_pan_amt:232,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:231,lfo_waveform:0,p:[0,0,0,0,1,1,1,1],c:[{n:[147,0,0,0,0,0,147,0,0,0,0,147,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:4,osc2_xenv:0,osc2_vol:192,osc2_waveform:3,noise_fader:0,env_attack:36863,env_sustain:35969,env_release:8772,env_master:192,fx_filter:1,fx_freq:3022,fx_resonance:255,fx_delay_time:4,fx_delay_amt:140,fx_pan_freq:3,fx_pan_amt:162,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:8,lfo_amt:255,lfo_waveform:0,p:[0,0,0,0,0,0,1,2,3],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,154,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[149,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,156,0,0,0,0,0,0,0,168,0,161,0,152,0,0,0]},{n:[171,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:4410,endPattern:11},titlesong:{songLen:37,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:7,osc2_xenv:0,osc2_vol:201,osc2_waveform:3,noise_fader:0,env_attack:789,env_sustain:1234,env_release:13636,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:6,fx_delay_amt:121,fx_pan_freq:6,fx_pan_amt:147,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0,p:[1,2,0,0,1,2,1,2],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,159,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:18,osc2_xenv:1,osc2_vol:191,osc2_waveform:2,noise_fader:0,env_attack:3997,env_sustain:56363,env_release:1e5,env_master:255,fx_filter:2,fx_freq:392,fx_resonance:255,fx_delay_time:8,fx_delay_amt:69,fx_pan_freq:5,fx_pan_amt:67,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:57,lfo_waveform:3,p:[1,2,1,2,1,2,1,2],c:[{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:60,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:1,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[0,0,0,0,1,1],c:[{n:[0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147,0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1],c:[{n:[147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:2418,env_sustain:1075,env_release:10614,env_master:240,fx_filter:3,fx_freq:2962,fx_resonance:255,fx_delay_time:6,fx_delay_amt:117,fx_pan_freq:3,fx_pan_amt:73,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:5,lfo_amt:124,lfo_waveform:0,p:[0,0,0,0,1,2,1,2],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,147,0,152,0,157,0,0,0,159,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1,2,1,3,1,3],c:[{n:[130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0,130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0]},{n:[123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0,123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0]},{n:[135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0,135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:255,osc2_waveform:0,noise_fader:127,env_attack:22,env_sustain:88,env_release:3997,env_master:255,fx_filter:3,fx_freq:4067,fx_resonance:234,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:2,fx_pan_amt:84,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:28,lfo_waveform:0,p:[0,0,1,2,1,2,1,3],c:[{n:[0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0,0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,147,0,0,0,154,0,0,0,154,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,0,0,147,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:255,env_attack:140347,env_sustain:9216,env_release:133417,env_master:208,fx_filter:2,fx_freq:2500,fx_resonance:16,fx_delay_time:2,fx_delay_amt:157,fx_pan_freq:8,fx_pan_amt:207,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:51,lfo_waveform:0,p:[0,0,1,1,1,1,1,1],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:5513,endPattern:9},letters:{".":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,1,,0]],1:[[,1,1,,0],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],2:[[1,1,1,1,0],[,,,,1],[,1,1,1,0],[1,,,,0],[1,1,1,1,1]],3:[[1,1,1,1,0],[,,,,1],[,1,1,1,1],[,,,,1],[1,1,1,1,0]],4:[[1,,,1,0],[1,,,1,0],[1,1,1,1,1],[,,,1,0],[,,,1,0]],5:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,0],[,,,,1],[1,1,1,1,0]],6:[[,1,1,1,0],[1,,,,0],[1,1,1,1,0],[1,,,,1],[,1,1,1,0]],7:[[1,1,1,1,1],[,,,,1],[,,,1,0],[,,1,,0],[,,1,,0]],8:[[,1,1,1,0],[1,,,,1],[,1,1,1,0],[1,,,,1],[,1,1,1,0]],9:[[,1,1,1,0],[1,,,,1],[,1,1,1,1],[,,,,1],[,1,1,1,0]],0:[[,1,1,1,0],[1,,,,1],[1,,,,1],[1,,,,1],[,1,1,1,0]],A:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],B:[[1,1,1,1,0],[1,,,1,0],[1,1,1,1,1],[1,,,,1],[1,1,1,1,1]],C:[[1,1,1,1,1],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],D:[[1,1,1,,0],[1,,,1,0],[1,,,,1],[1,,,,1],[1,1,1,1,1]],E:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,,,,0]],G:[[1,1,1,1,1],[1,,,,0],[1,,1,1,1],[1,,,,1],[1,1,1,1,1]],H:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],I:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],J:[[,,,,1],[,,,,1],[,,,,1],[1,,,,1],[1,1,1,1,1]],K:[[1,,,1,0],[1,,1,,0],[1,1,1,,0],[1,,,1,0],[1,,,,1]],L:[[1,,,,0],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],M:[[1,,,,1],[1,1,,1,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,,1],[1,1,,,1],[1,,1,,1],[1,,,1,1],[1,,,,1]],O:[[1,1,1,1,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],P:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,0],[1,,,,0]],Q:[[1,1,1,1,0],[1,,,1,0],[1,,,1,0],[1,,,1,0],[1,1,1,1,1]],R:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,1,0],[1,,,,1]],S:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,1],[,,,,1],[1,1,1,1,1]],T:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[,,1,,0]],U:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],V:[[1,,,,1],[1,,,,1],[1,,,,1],[,1,,1,0],[,,1,,0]],W:[[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,,1,1],[1,,,,1]],X:[[1,,,,1],[,1,,1,0],[,,1,,0],[,1,,1,0],[1,,,,1]],Y:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[,,1,,0],[,,1,,0]],Z:[[1,1,1,1,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,1,1,1,1]]," ":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,,,0]],",":[[,,,,0],[,,,,0],[,,,,0],[,,1,,0],[,,1,,0]],"+":[[,,,,0],[,,1,,0],[,1,1,1,0],[,,1,,0],[,,,,0]],"/":[[,,,,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,,,,0]],":":[[,,,,0],[,,1,,0],[,,,,0],[,,1,,0],[,,,,0]],"@":[[1,1,1,1,1],[,,,,1],[1,1,1,,1],[1,,1,,1],[1,1,1,1,1]],x:[[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1]],z:[[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0]],o:[[1,1,1,1,1],[1,,,,1],[1,,1,,1],[1,,,,1],[1,1,1,1,1]],e:[[1,,,,0],[1,1,,,0],[1,1,1,,0],[1,1,1,1,0],[1,1,1,1,1]],w:[[,,,,1],[,,,1,1],[,,1,1,1],[,1,1,1,1],[1,1,1,1,1]],s:[[1,1,1,1,1],[,1,1,1,1],[,,1,1,1],[,,,1,1],[,,,,1]],d:[[1,1,1,1,1],[1,1,1,1,0],[1,1,1,,0],[1,1,,,0],[1,,,,0]]}};Txt={textLine:function(a){a.glitch||(a.glitch={xch:0,ych:0,xamt:0,yamt:0});for(var b=a.text.length,c=5,d=0;b>d;d++)for(var e=A.letters[a.text.charAt(d)]||A.letters.unknown,f=0;c>f;f++)for(var g=0;c>g;g++)if(1===e[f][g]){var h=(Math.random()>a.glitch.xch)*(Math.random()-.5)*a.glitch.xamt,i=(Math.random()>a.glitch.ych)*(Math.random()-.5)*a.glitch.yamt;a.ctx.fillRect(a.x+g*a.scale+h+(c*a.scale+a.hspacing)*d,a.y+f*a.scale+i,a.scale,a.scale)}},text:function(a){var b=5,c=b*a.scale,d=a.text.split("\n"),e=d.slice(0),f=d.length,g=e.sort(function(a,b){return b.length-a.length})[0],h=g.length*c+(g.length-1)*a.hspacing,i=f*c+(f-1)*a.vspacing,j=a.x,k=a.y,l=a.x+h,m=a.y+i;"center"==a.halign?(j=a.x-h/2,l=a.x+h/2):"right"==a.halign&&(j=a.x-h,l=a.x),"center"==a.valign?(k=a.y-i/2,m=a.y+i/2):"bottom"==a.valign&&(k=a.y-i,m=a.y);var n=j+h/2,o=k+i/2;if(a.render)for(var p=0;f>p;p++){var q=d[p],r=q.length*c+(q.length-1)*a.hspacing,s=a.x,t=a.y+(c+a.vspacing)*p;"center"==a.halign?s=a.x-r/2:"right"==a.halign&&(s=a.x-r),"center"==a.valign?t-=i/2:"bottom"==a.valign&&(t-=i),a.snap&&(s=Math.floor(s),t=Math.floor(t)),this.textLine({ctx:a.ctx,x:s,y:t,text:q,hspacing:a.hspacing||0,scale:a.scale||1,glitchChance:a.glitchChance,glitchFactor:a.glitchFactor})}return{sx:j,sy:k,cx:n,cy:o,ex:l,ey:m,width:h,height:i}}},Particle=function(a){return this.body=new Entity({radius:a.radius||.5,type:a.type,collides:!1,mapcollide:!0,gravity:a.gravity||.01,dx:a.dx||0,dy:a.dy||0}),this.life=a.life,this.remaining=a.life,this.color=a.color,this.body.setCoords(a.x,a.y),Particle.prototype.update=function(a){this.remaining-=a,this.remaining<0&&this.body.die()},Particle.prototype.render=function(a){var b=this.body;a.fillStyle=this.color||"#fff";var c=this.body.radius*(this.remaining/this.life);a.fillRect(b.xx-c,b.yy-c,c,c)},this},Entity=function(a){var b=this;a||(a={radius:10,gravity:0,type:"generic",frictX:.92,frictY:.94}),b.type=a.type,b.cx=0,b.cy=0,b.xr=0,b.yr=0,b.xx=0,b.yy=0,b.dx=0,b.dy=0,b.collided=!1,b.ox=0,b.oy=0,b.radius=a.radius||10,b.gravity=a.gravity||0,b.frictX=a.frictX||.92,b.frictY=a.frictY||.94,b.dead=!1,b.collides=a.collides||0,b.mapcollide=a.mapcollide||0,b.id=Math.random()},Entity.prototype.die=function(){var b=this;b.dead=!0,a.splice(a.indexOf(b),1)},Entity.prototype.setCoords=function(a,b){var c=this;c.xx=a,c.yy=b,c.cx=Math.floor(c.xx/s.GRID),c.cy=Math.floor(c.yy/s.GRID),c.xr=(c.xx-c.cx*s.GRID)/s.GRID,c.yr=(c.yy-c.cy*s.GRID)/s.GRID},Entity.prototype.hasCollision=function(a,b){var c=this;return c.mapcollide?void 0==A.map[b]||void 0==A.map[b][a]?!1:A.map[b][a]||!1:void 0},Entity.prototype.overlaps=function(a){var b=this,c=b.radius+a.radius,d=(a.xx-b.xx)*(a.xx-b.xx)+(a.yy-b.yy)*(a.yy-b.yy);return d>c*c?!1:!0},Entity.prototype.onGround=function(){var a=this;return a.hasCollision(a.cx,a.cy+1)&&a.yr>=.5},Entity.prototype.onCeiling=function(){var a=this;return a.hasCollision(a.cx,a.cy-1)&&a.yr<=.5},Entity.prototype.onWallLeft=function(){var a=this;return a.hasCollision(a.cx-1,a.cy)&&a.xr<=.5},Entity.prototype.onWallRight=function(){var a=this;return a.hasCollision(a.cx+1,a.cy)&&a.xr>=.5},Entity.prototype.update=function(){var b=this;if(0==b.dead){var c=b.gravity;for(b.xr+=b.dx,b.dx*=b.frictX,b.hasCollision(b.cx-1,b.cy)&&b.xr<=.3&&(b.dx=0,b.xr=.3),b.hasCollision(b.cx+1,b.cy)&&b.xr>=.7&&(b.dx=0,b.xr=.7);b.xr<0;)b.cx--,b.xr++;for(;b.xr>1;)b.cx++,b.xr--;for(b.dy+=c,b.yr+=b.dy,b.dy*=b.frictY,b.hasCollision(b.cx,b.cy-1)&&b.yr<=.4&&(b.dy=0,b.yr=.4),b.hasCollision(b.cx,b.cy+1)&&b.yr>=.7&&(b.dy=0,b.yr=.7);b.yr<0;)b.cy--,b.yr++;for(;b.yr>1;)b.cy++,b.yr--;for(var d=0;d<a.length;d++){var e=a[d].body;if(0==e.dead&&e.collides&&e!=b&&Math.abs(b.cx-e.cx)<=1&&Math.abs(b.cy-e.cy)<=1){var f=Math.sqrt((e.xx-b.xx)*(e.xx-b.xx)+(e.yy-b.yy)*(e.yy-b.yy));if(f<=b.radius+e.radius){b.collided=!0;var g=Math.atan2(e.yy-b.yy,e.xx-b.xx),h=.03,i=(b.radius+e.radius-f)/(b.radius+e.radius);b.dx-=Math.cos(g)*i*h,b.dy-=Math.sin(g)*i*h,e.dx+=Math.cos(g)*i*h,e.dy+=Math.sin(g)*i*h}}}b.xx=Math.floor((b.cx+b.xr)*s.GRID),b.yy=Math.floor((b.cy+b.yr)*s.GRID),b.ddx=(b.cx+b.xr)*s.GRID-b.ox,b.ddy=(b.cy+b.yr)*s.GRID-b.oy,b.ox=(b.cx+b.xr)*s.GRID,b.oy=(b.cy+b.yr)*s.GRID}return this};var B={},C=44100,D=2,E=33,F=null;function G(a){return Math.sin(6.283184*a)}function H(a){return G(a)<0?-1:1}function I(a){return a%1-.5}function J(a){var b=a%1*4;return 2>b?b-1:3-b}var K=[G,H,I,J];function L(a){return.00390625*Math.pow(1.059463094,a-128)}function M(a,b){setTimeout(function(){var c=new Uint8Array(a*D*2),d=c.length-2,e=function(){for(var a=new Date,f=0;d>=0;)if(c[d]=0,c[d+1]=128,d-=2,f+=1,f%1e3===0&&new Date-a>E)return void setTimeout(e,0);setTimeout(function(){b(c)},0)};setTimeout(e,0)},0)}function N(a,b,c,d,e){var f=c.fx_delay_time*d>>1,g=c.fx_delay_amt/255,h=0,i=function(){for(var c=new Date,d=0;b-f>h;){var j=4*h,k=4*(h+f),l=a[k]+(a[k+1]<<8)+(a[j+2]+(a[j+3]<<8)-32768)*g;if(a[k]=255&l,a[k+1]=l>>8&255,l=a[k+2]+(a[k+3]<<8)+(a[j]+(a[j+1]<<8)-32768)*g,a[k+2]=255&l,a[k+3]=l>>8&255,++h,d+=1,d%1e3===0&&new Date-c>E)return void setTimeout(i,0)}setTimeout(e,0)};setTimeout(i,0)}B.AudioGenerator=function(a){this.mixBuf=a,this.waveSize=a.length/D/2},B.AudioGenerator.prototype.getWave=function(){var a,b,c,d,e,f,g,h=this.mixBuf,i=this.waveSize,j=i*D*2;for(e=j-8,f=e-36,d=String.fromCharCode(82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&f,f>>8&255,f>>16&255,f>>24&255),a=0;j>a;){for(c="",b=0;256>b&&j>a;++b,a+=2)g=4*(h[a]+(h[a+1]<<8)-32768),g=-32768>g?-32768:g>32767?32767:g,
c+=String.fromCharCode(255&g,g>>8&255);d+=c}return d},B.AudioGenerator.prototype.getAudio=function(){var a=this.getWave(),b=new Audio("data:audio/wav;base64,"+btoa(a));return b.preload="none",b.load(),b},B.AudioGenerator.prototype.getAudioBuffer=function(a){null===F&&(F=new AudioContext);var b=this.mixBuf,c=this.waveSize,d=c*D*2,e=F.createBuffer(D,this.waveSize,C),f=e.getChannelData(0),g=e.getChannelData(1),h=0,i=function(){for(var c=new Date,j=0;d/2>h;){var k=4*(b[4*h]+(b[4*h+1]<<8)-32768);if(k=-32768>k?-32768:k>32767?32767:k,f[h]=k/32768,k=4*(b[4*h+2]+(b[4*h+3]<<8)-32768),k=-32768>k?-32768:k>32767?32767:k,g[h]=k/32768,h+=1,j+=1,j%1e3===0&&new Date-c>E)return void setTimeout(i,0)}setTimeout(function(){a(e)},0)};setTimeout(i,0)},B.SoundGenerator=function(a,b){this.instr=a,this.rowLen=b||5605,this.osc_lfo=K[a.lfo_waveform],this.osc1=K[a.osc1_waveform],this.osc2=K[a.osc2_waveform],this.attack=a.env_attack,this.sustain=a.env_sustain,this.release=a.env_release,this.panFreq=Math.pow(2,a.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,a.lfo_freq-8)/this.rowLen},B.SoundGenerator.prototype.genSound=function(a,b,c){for(var d=(new Date,0),e=0,f=L(a+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),g=L(a+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),h=this.instr.fx_resonance/255,i=0,j=0,k=this.attack+this.sustain+this.release-1;k>=0;--k){var l=k+c,m=this.osc_lfo(l*this.lfoFreq)*this.instr.lfo_amt/512+.5,n=1;k<this.attack?n=k/this.attack:k<this.attack+this.sustain||(n-=(k-this.attack-this.sustain)/this.release);var o=f;this.instr.lfo_osc1_freq&&(o+=m),this.instr.osc1_xenv&&(o*=n*n),d+=o;var p=this.osc1(d)*this.instr.osc1_vol;o=g,this.instr.osc2_xenv&&(o*=n*n),e+=o,p+=this.osc2(e)*this.instr.osc2_vol,this.instr.noise_fader&&(p+=(2*Math.random()-1)*this.instr.noise_fader*n),p*=n/255;var q=this.instr.fx_freq;this.instr.lfo_fx_freq&&(q*=m),q=1.5*Math.sin(3.141592*q/C),i+=q*j;var r=h*(p-j)-i;switch(j+=q*r,this.instr.fx_filter){case 1:p=r;break;case 2:p=i;break;case 3:p=j;break;case 4:p=i+r}if(o=G(l*this.panFreq)*this.instr.fx_pan_amt/512+.5,p*=39*this.instr.env_master,l=4*l,l+3<b.length){var s=b[l]+(b[l+1]<<8)+p*(1-o);b[l]=255&s,b[l+1]=s>>8&255,s=b[l+2]+(b[l+3]<<8)+p*o,b[l+2]=255&s,b[l+3]=s>>8&255}}},B.SoundGenerator.prototype.getAudioGenerator=function(a,b){var c=this.attack+this.sustain+this.release-1+32*this.rowLen,d=this;M(c,function(e){d.genSound(a,e,0),N(e,c,d.instr,d.rowLen,function(){b(new B.AudioGenerator(e))})})},B.SoundGenerator.prototype.createAudio=function(a,b){this.getAudioGenerator(a,function(a){b(a.getAudio())})},B.SoundGenerator.prototype.createAudioBuffer=function(a,b){this.getAudioGenerator(a,function(a){a.getAudioBuffer(b)})},B.MusicGenerator=function(a){this.song=a,this.waveSize=C*a.songLen},B.MusicGenerator.prototype.generateTrack=function(a,b,c){var d=this;M(this.waveSize,function(e){var f=d.waveSize,g=d.waveSize*D*2,h=d.song.rowLen,i=d.song.endPattern,j=new B.SoundGenerator(a,h),k=0,l=0,m=0,n=function(){for(var b=new Date;;)if(32!==m){if(l===i-1)return void setTimeout(o,0);var c=a.p[l];if(c){var d=a.c[c-1].n[m];d&&j.genSound(d,e,k)}if(k+=h,m+=1,new Date-b>E)return void setTimeout(n,0)}else m=0,l+=1},o=function(){N(e,f,a,h,q)},p=0,q=function(){for(var a=new Date,d=0;g>p;){var f=b[p]+(b[p+1]<<8)+e[p]+(e[p+1]<<8)-32768;if(b[p]=255&f,b[p+1]=f>>8&255,p+=2,d+=1,d%1e3===0&&new Date-a>E)return void setTimeout(q,0)}setTimeout(c,0)};setTimeout(n,0)})},B.MusicGenerator.prototype.getAudioGenerator=function(a){var b=this;M(this.waveSize,function(c){var d=0,e=function(){d<b.song.songData.length?(d+=1,b.generateTrack(b.song.songData[d-1],c,e)):a(new B.AudioGenerator(c))};e()})},B.MusicGenerator.prototype.createAudio=function(a){this.getAudioGenerator(function(b){a(b.getAudio())})},B.MusicGenerator.prototype.createAudioBuffer=function(a){this.getAudioGenerator(function(b){b.getAudioBuffer(a)})},window.onload=u()}();
</script></body></html>